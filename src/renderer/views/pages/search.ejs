<script type="text/x-template" id="cider-search">
    <div class="content-inner">
        <div v-if="search != null && search != [] && search.term != ''">
            <h3>{{app.getLz('term.topResult')}}</h3>
            <mediaitem-scroller-horizontal
                                :items="search.results[search.results.meta.results.order[0]]['data']"></mediaitem-scroller-horizontal>
            <div class="row">
                <div v-else style="text-align: center">
                    <h3>{{app.getLz('error.noResults')}}</h3>
                    <p>{{app.getLz('error.noResults.description')}}</p>
                </div>
                <div class="col" v-if="search.results.song">
                    <div class="row">
                        <div class="col">
                            <h3>{{app.getLz('term.songs')}}</h3>
                        </div>
                        <div class="col-auto flex-center"
                            @click="app.showSearchView(app.search.term, 'song', app.friendlyTypes('song'))"
                            v-if="search.results.song.data.length >= 12">
                            <button class="cd-btn-seeall">{{app.getLz('term.seeAll')}}</button>
                        </div>
                    </div>
                    <div class="mediaitem-list-item__grid">
                        <listitem-horizontal :items="search.results.song.data.limit(12)">
                        </listitem-horizontal>
                    </div>
                </div>
            </div>

            <template v-if="search.results['meta'] != null">
                <template
                        v-for="section in search.results.meta.results.order" v-if="section != 'song' && section != 'top'">
                    <div class="row">
                        <div class="col">
                            <h3>{{ app.friendlyTypes(section) }}</h3>
                        </div>
                        <div class="col-auto flex-center" v-if="search.results[section].data.length >= 10">
                            <button class="cd-btn-seeall"
                                    @click="app.showSearchView(app.search.term, section, app.friendlyTypes(section))">{{app.getLz('term.seeAll')}}
                            </button>
                        </div>
                    </div>
                    <template v-if="!app.friendlyTypes(section).includes('Video')">
                        <mediaitem-scroller-horizontal-large
                                :items="search.results[section].data.limit(10)"></mediaitem-scroller-horizontal-large>
                    </template>
                    <template v-else>
                        <mediaitem-scroller-horizontal-mvview
                                :items="search.results[section].data.limit(10)"></mediaitem-scroller-horizontal-mvview>
                    </template>
                </template>
            </template>
            <template v-if="search.resultsSocial.playlist">
                <div class="row">
                    <div class="col">
                        <h3>{{app.getLz('term.sharedPlaylists')}}</h3>
                    </div>
                    <div class="col-auto flex-center" v-if="search.resultsSocial.playlist.data.length >= 10">
                        <button class="cd-btn-seeall"
                                @click="app.showCollection(search.resultsSocial.playlist, 'Shared Playlists', 'default')">{{app.getLz('term.seeAll')}}
                        </button>
                    </div>
                </div>
                <mediaitem-scroller-horizontal-large
                        :items="search.resultsSocial.playlist.data.limit(10)"></mediaitem-scroller-horizontal-large>
            </template>
            <template v-if="search.resultsSocial.profile">
                <div class="row">
                    <div class="col">
                        <h3>{{app.getLz('term.people')}}</h3>
                    </div>
                    <div class="col-auto flex-center" v-if="search.resultsSocial.profile.data.length >= 10">
                        <button class="cd-btn-seeall"
                                @click="app.showCollection(search.resultsSocial.profile, 'People', 'default')">{{app.getLz('term.seeAll')}}
                        </button>
                    </div>
                </div>
                <mediaitem-scroller-horizontal-large
                        :items="search.resultsSocial.profile.data.limit(10)"></mediaitem-scroller-horizontal-large>
            </template>
        </div>
        <div v-else>
           <div v-if="categoriesReady || getCategories()">
                <div>
                    <div class="col" v-if="categoriesView != null && categoriesView != [] && categoriesView[0].attributes != null && categoriesView[0].attributes.title != null">
                        <h3>{{categoriesView[0].attributes.title.stringForDisplay ?? ""}}</h3>
                    </div>  
                    <mediaitem-square :kind="'385'" size="600"
                    :item="item ? (item.attributes.kind ? item : ((item.relationships && item.relationships.contents ) ? item.relationships.contents.data[0] : item)) : []"
                    :imagesize="800"
                    v-for="item of categoriesView"></mediaitem-square>
                </div>
           </div>
        </div>    
    </div>
</script>

<script>
    Vue.component('cider-search', {
        template: "#cider-search",
        props: ['search'],
        data: function () {
            return {
                app: this.$root,
                categoriesView: [],
                categoriesReady: false,
            }
        },
        methods: {
            getTopResult() {
                try {
                    return this.search.results[this.search.results.meta.results.order[0]]["data"][0]
                } catch (error) {
                    return false
                }
            },
            async getCategories() {
                if (this.categoriesView != [] && this.categoriesView.length > 0) { this.categoriesReady = true; return await true; } else {
                   let response = await app.mk.api.music(`/v1/catalog/${app.mk.storefrontId}/apple-curators`, {
                        ids: [
                            "1514706977",
                            "1526756058",
                            "976439548",
                            "988658197",
                            "1526866702",
                            "1526866635",
                            "1526866514",
                            "1526866189",
                            "1528869584",
                            "1441811365",
                            "1558257257",
                            "989061415",
                            "989010186",
                            "1558256251",
                            "1558256771",
                            "1558256865",
                            "1526866649",
                            "1558257443",
                            "1558257095",
                            "1558256919",
                            "1558257331",
                            "1558257146",
                            "1558257035",
                            "1558256909",
                            "1531539531",
                            "1482068485",
                            "976439541",
                            "982356297",
                            "982307152",
                            "989058908",
                            "988658199",
                            "988656613",
                            "1479949880",
                            "987714244",
                            "976439534",
                            "1013624291",
                            "976439536",
                            "1013613723",
                            "1531542847",
                            "976439535",
                            "1554938339",
                            "983062953",
                            "982346310",
                            "1232062136",
                            "982356299"
                        ]
                    })
                    this.categoriesView = response.data.data;
                    console.log(this.categoriesView)
                    this.categoriesReady = true;
                    return await true;
                }
            },
            getFlattenedCategories() {
                let flattened = this.categoriesView;
                return flattened;
            }
        }
    })
</script>